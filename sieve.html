<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sieve of Eratosthenes &#8212; toycrypto 0.4.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="_static/css/sphinx-toolbox.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_toolbox_installation.css" />
    <script src="_static/documentation_options.js?v=6c02275b"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=5572e0a9"></script>
    <script src="_static/sphinx_toolbox_installation.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RSA" href="rsa.html" />
    <link rel="prev" title="Number Theory" href="nt.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rsa.html" title="RSA"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nt.html" title="Number Theory"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">toycrypto 0.4.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sieve of Eratosthenes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Nothing here should be used for any security purposes.</p>
<ul class="simple">
<li><p>If you need cryptographic tools in a Python environment use <a class="reference external" href="https://cryptography.io/en/latest/">pyca</a>.</p></li>
<li><p>If you need efficient and reliable abstract math utilities in a Python-like environment consider using <a class="reference external" href="https://www.sagemath.org">SageMath</a>.</p></li>
</ul>
</div>
<section id="module-toy_crypto.sieve">
<span id="sieve-of-eratosthenes"></span><h1>Sieve of Eratosthenes<a class="headerlink" href="#module-toy_crypto.sieve" title="Link to this heading">¶</a></h1>
<p>This module is imported with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">toy_crypto.sieve</span>
</pre></div>
</div>
<p>The module contains classes for the factorization of numbers and for creating a sieve of Eratosthenes.</p>
<section id="why-three-separate-implementations">
<h2>Why three separate implementations?<a class="headerlink" href="#why-three-separate-implementations" title="Link to this heading">¶</a></h2>
<p>It is reasonable to wonder why I have three distinct implementations.
There are reasons, but first let me give an overview of the major differences.</p>
<ul>
<li><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> class</p>
<blockquote>
<div><p>This uses the <a class="reference external" href="https://github.com/ilanschnell/bitarray">bitarray</a> package underlyingly.
It is by far the most time and memory efficient of the implemenations here.
The <a class="reference external" href="https://github.com/ilanschnell/bitarray">bitarray</a> package is written in C,
and as a consequence it cannot be installed in certain environments.</p>
</div></blockquote>
</li>
<li><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code> class</p>
<blockquote>
<div><p>This is a pure Python implementation that uses <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> when creating the sieve.
This consumes a lot of memmory.
For a brief time during initialization there will be a set with all integers from 2 through n.
The set will rapidly have elements removed from it,
but the end results will still contain all of the primes as Python integers.</p>
</div></blockquote>
</li>
<li><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">IntSieve</span></code> class</p>
<blockquote>
<div><p>This is also a pure Python implementation that uses a Python integer as the sieve and uses bit twidling when creating the sieve. This makes it memory efficient, but it is excruciatingly slow.</p>
</div></blockquote>
</li>
</ul>
<figure class="align-default" id="id1">
<span id="all-figure"></span><img alt="Graph showing that IntSieve creation time is really slow" src="_images/all_data.png" />
<figcaption>
<p><span class="caption-text">Seconds to create sieves</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
<div class="legend">
<p>Time it takes in seconds for sieves of various sizes from 100 to 100000
to be created by the different classes.</p>
</div>
</figcaption>
</figure>
<p>The very real time differences between the creating a <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> and a <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code> is obscured in figure <a class="reference internal" href="#all-figure"><span class="std std-ref">Seconds to create sieves</span></a> by the enormous amount
of time it takes to construct an <code class="xref py py-class docutils literal notranslate"><span class="pre">IntSieve</span></code>.
So here is a graph showing the times just for <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> and a <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code>.</p>
<figure class="align-default" id="id2">
<span id="sans-int-figure"></span><img alt="Graph showing that Sieve is more efficient than SetSeive" src="_images/sans_int.png" />
<figcaption>
<p><span class="caption-text">Seconds to create sieves (without IntSieve).</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Specifically on my system it took approximately 0.011 seconds to create a sieve of all numbers less than or equal to 1 million using the bitarray-based <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code>,
0.198 seconds with <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSeive</span></code>,
and a minute (59.796 seconds) with <code class="xref py py-class docutils literal notranslate"><span class="pre">IntSieve</span></code>.
So bitaray was nearly 20 times faster than the set-based sieve construction
and more than 5000 times faster than the integer-based construction for a sieve size of one million.</p>
</section>
<section id="the-algorithm">
<h2>The algorithm<a class="headerlink" href="#the-algorithm" title="Link to this heading">¶</a></h2>
<p>The algoritm for creating the sieve is the same for all three classes
but has fiddly differences due to how the seive is represented.
This, pared down and modified so as to work all by itself,
version from the <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code> is probably the most
readable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isqrt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>

    <span class="c1"># This is where the heavy memory consumption comes in.</span>
    <span class="n">sieve</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># We only need to go up to and including the square root of n,</span>
    <span class="c1"># remove all non-primes above that square-root =&lt; n.</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sieve</span><span class="p">:</span>
            <span class="c1"># Because we are going through sieve in numeric order</span>
            <span class="c1"># we know that multiples of anything less than p have</span>
            <span class="c1"># already been removed, so p is prime.</span>
            <span class="c1"># Our job is to now remove multiples of p</span>
            <span class="c1"># higher up in the sieve.</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
                <span class="n">sieve</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sieve</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sieve100</span> <span class="o">=</span> <span class="n">make_sieve</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sieve100</span><span class="p">)</span>
<span class="go">25</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sieve100</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">[2, 3, 5, 7, 11]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sieve100</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<span class="go">[73, 79, 83, 89, 97]</span>
</pre></div>
</div>
</section>
<section id="the-sievish-protocol">
<h2>The <code class="xref py py-protocol docutils literal notranslate"><span class="pre">Sievish</span></code> Protocol<a class="headerlink" href="#the-sievish-protocol" title="Link to this heading">¶</a></h2>
</section>
<section id="the-sieve-alias">
<h2>The <a class="reference internal" href="#toy_crypto.sieve.Sieve" title="toy_crypto.sieve.Sieve"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sieve</span></code></a> alias<a class="headerlink" href="#the-sieve-alias" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="toy_crypto.sieve.Sieve">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">toy_crypto.sieve.</span></span><span class="sig-name descname"><span class="pre">Sieve</span></span><a class="headerlink" href="#toy_crypto.sieve.Sieve" title="Link to this definition">¶</a></dt>
<dd><p>Sieve will be an alias for <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> if <a class="reference external" href="https://github.com/ilanschnell/bitarray">bitarray</a> is available, otherwise it will be assigned to some other sieve class.</p>
</dd></dl>

</section>
</section>
<section id="the-concrete-classes">
<h1>The concrete classes<a class="headerlink" href="#the-concrete-classes" title="Link to this heading">¶</a></h1>
<section id="the-basieve-class">
<h2>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> class<a class="headerlink" href="#the-basieve-class" title="Link to this heading">¶</a></h2>
</section>
<section id="the-setsieve-class">
<h2>The <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code> class<a class="headerlink" href="#the-setsieve-class" title="Link to this heading">¶</a></h2>
</section>
<section id="the-intsieve-class">
<h2>The <code class="xref py py-class docutils literal notranslate"><span class="pre">IntSieve</span></code> class<a class="headerlink" href="#the-intsieve-class" title="Link to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Sieve of Eratosthenes</a><ul>
<li><a class="reference internal" href="#why-three-separate-implementations">Why three separate implementations?</a></li>
<li><a class="reference internal" href="#the-algorithm">The algorithm</a></li>
<li><a class="reference internal" href="#the-sievish-protocol">The <code class="xref py py-protocol docutils literal notranslate"><span class="pre">Sievish</span></code> Protocol</a></li>
<li><a class="reference internal" href="#the-sieve-alias">The <code class="xref py py-class docutils literal notranslate"><span class="pre">Sieve</span></code> alias</a><ul>
<li><a class="reference internal" href="#toy_crypto.sieve.Sieve"><code class="docutils literal notranslate"><span class="pre">Sieve</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-concrete-classes">The concrete classes</a><ul>
<li><a class="reference internal" href="#the-basieve-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">BaSieve</span></code> class</a></li>
<li><a class="reference internal" href="#the-setsieve-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">SetSieve</span></code> class</a></li>
<li><a class="reference internal" href="#the-intsieve-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">IntSieve</span></code> class</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="nt.html"
                          title="previous chapter">Number Theory</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="rsa.html"
                          title="next chapter">RSA</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sieve.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rsa.html" title="RSA"
             >next</a> |</li>
        <li class="right" >
          <a href="nt.html" title="Number Theory"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">toycrypto 0.4.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sieve of Eratosthenes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024–2025 Jeffrey Goldberg.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.3.0+/e4b5fc5.
    </div>
  </body>
</html>